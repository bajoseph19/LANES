{% extends "base.html" %}

{% block title %}Dashboard - LANES{% endblock %}

{% block content %}
<div class="dashboard">
    <div class="dashboard-header">
        <h1>My Recipes</h1>
        <a href="{{ url_for('parse_recipe') }}" class="btn btn-primary">+ Add New Recipe</a>
    </div>
    
    {% if recipes %}
        <div class="recipe-list">
            {% for recipe in recipes %}
                <div class="recipe-card">
                    <div class="recipe-header">
                        <h3>{{ recipe.title }}</h3>
                        <span class="recipe-date">{{ recipe.created_at.strftime('%B %d, %Y') }}</span>
                    </div>
                    <div class="recipe-meta">
                        <span class="ingredient-count">{{ recipe.ingredients|length }} ingredients</span>
                        <a href="{{ recipe.url }}" target="_blank" class="recipe-url">View Original</a>
                    </div>
                    <div class="recipe-actions">
                        <a href="{{ url_for('view_recipe', recipe_id=recipe.id) }}" class="btn btn-sm">View Details</a>
                        <button onclick="deleteRecipe({{ recipe.id }})" class="btn btn-sm btn-danger">Delete</button>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <p>You haven't added any recipes yet.</p>
            <a href="{{ url_for('parse_recipe') }}" class="btn btn-primary">Add Your First Recipe</a>
        </div>
    {% endif %}
</div>

<script>
function deleteRecipe(recipeId) {
    if (!confirm('Are you sure you want to delete this recipe?')) {
        return;
    }
    
    fetch(`/api/delete-recipe/${recipeId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        } else {
            alert('Error deleting recipe');
        }
    })
    .catch(error => {
        alert('Error deleting recipe');
        console.error(error);
    });
}
</script>
{% endblock %}
